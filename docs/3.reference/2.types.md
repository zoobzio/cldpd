---
title: Types Reference
description: Type definitions, configuration schema, and error types
author: zoobzio
published: 2026-02-21
updated: 2026-02-21
tags:
  - Reference
  - Types
---

# Types Reference

## Pod

A discovered pod definition.

```go
type Pod struct {
    Name       string
    Dir        string
    Config     PodConfig
    Dockerfile string
}
```

| Field | Type | Description |
|-------|------|-------------|
| Name | string | Pod name, derived from directory name |
| Dir | string | Absolute path to the pod directory |
| Config | PodConfig | Parsed configuration from pod.json |
| Dockerfile | string | Absolute path to the Dockerfile |

## PodConfig

Optional configuration parsed from `pod.json`.

```go
type PodConfig struct {
    Image     string            `json:"image"`
    Env       map[string]string `json:"env"`
    BuildArgs map[string]string `json:"buildArgs"`
    Workdir   string            `json:"workdir"`
}
```

| Field | Type | JSON Key | Default | Description |
|-------|------|----------|---------|-------------|
| Image | string | `image` | `cldpd-<podname>` | Docker image tag override |
| Env | map[string]string | `env` | nil | Environment variables passed to the container |
| BuildArgs | map[string]string | `buildArgs` | nil | Docker build arguments (`--build-arg K=V`) |
| Workdir | string | `workdir` | empty | Working directory inside the container (`-w` flag) |

All fields are optional. If `pod.json` is absent, all fields use their zero values.

## Runner

Interface over Docker CLI operations.

```go
type Runner interface {
    Build(ctx context.Context, tag string, dir string, buildArgs map[string]string) error
    Run(ctx context.Context, opts RunOptions, stdout io.Writer) (int, error)
    Exec(ctx context.Context, container string, cmd []string, stdout io.Writer) (int, error)
}
```

`DockerRunner` is the standard implementation using `os/exec`. Custom implementations can be provided for testing or alternative container runtimes.

## RunOptions

Configuration for a `docker run` invocation.

```go
type RunOptions struct {
    Image   string
    Name    string
    Cmd     []string
    Env     map[string]string
    Workdir string
    Remove  bool
}
```

| Field | Type | Description |
|-------|------|-------------|
| Image | string | Docker image to run |
| Name | string | Container name (`cldpd-<podname>`) |
| Cmd | []string | Command and arguments (`["claude", "-p", "..."]`) |
| Env | map[string]string | Environment variables (`-e K=V`) |
| Workdir | string | Working directory inside container (`-w`) |
| Remove | bool | Remove container on exit (`--rm`) |

## Dispatcher

Coordinates pod discovery, image building, and container lifecycle.

```go
type Dispatcher struct {
    // unexported fields
}
```

Created via `NewDispatcher(podsDir, runner)`. The Dispatcher does not export its fields -- interact with it through `Start` and `Resume`.

## DockerRunner

Implements `Runner` using the Docker CLI via `os/exec`.

```go
type DockerRunner struct{}
```

Zero-value is ready to use. Also provides `Preflight(ctx)` for Docker availability checks.

## Errors

Semantic sentinel errors checked with `errors.Is`:

```go
var (
    ErrPodNotFound       = errors.New("pod not found")
    ErrInvalidPod        = errors.New("invalid pod: Dockerfile not found")
    ErrBuildFailed       = errors.New("image build failed")
    ErrContainerFailed   = errors.New("container exited with error")
    ErrSessionNotFound   = errors.New("no running session for pod")
    ErrDockerUnavailable = errors.New("docker is not available")
)
```

| Error | Returned By | Meaning |
|-------|-------------|---------|
| `ErrPodNotFound` | DiscoverPod, Start | Pod directory does not exist |
| `ErrInvalidPod` | DiscoverPod, Start | Pod directory has no Dockerfile |
| `ErrBuildFailed` | Build, Start | Docker image build failed |
| `ErrContainerFailed` | Start | Container exited with non-zero code |
| `ErrSessionNotFound` | Exec, Resume | No running container for the pod |
| `ErrDockerUnavailable` | Preflight | Docker daemon unreachable |

Errors are wrapped with context at call sites using `fmt.Errorf("...: %w", err)`. Use `errors.Is` to check for specific conditions:

```go
code, err := d.Start(ctx, "myrepo", issueURL, os.Stdout)
if errors.Is(err, cldpd.ErrPodNotFound) {
    // pod directory does not exist
}
if errors.Is(err, cldpd.ErrContainerFailed) {
    // container exited non-zero, code holds the exit code
}
```
