---
title: Types Reference
description: Type definitions, configuration schema, and error types
author: zoobzio
published: 2026-02-21
updated: 2026-02-22
tags:
  - Reference
  - Types
---

# Types Reference

## Pod

A discovered pod definition.

```go
type Pod struct {
    Name       string
    Dir        string
    Config     PodConfig
    Dockerfile string
}
```

| Field | Type | Description |
|-------|------|-------------|
| Name | string | Pod name, derived from directory name |
| Dir | string | Absolute path to the pod directory |
| Config | PodConfig | Parsed configuration from pod.json |
| Dockerfile | string | Absolute path to the Dockerfile |

## PodConfig

Optional configuration parsed from `pod.json`.

```go
type PodConfig struct {
    Image      string            `json:"image"`
    Env        map[string]string `json:"env"`
    BuildArgs  map[string]string `json:"buildArgs"`
    Workdir    string            `json:"workdir"`
    InheritEnv []string          `json:"inheritEnv"`
    Mounts     []Mount           `json:"mounts"`
}
```

| Field | Type | JSON Key | Default | Description |
|-------|------|----------|---------|-------------|
| Image | string | `image` | `cldpd-<podname>` | Docker image tag override |
| Env | map[string]string | `env` | nil | Environment variables passed to the container |
| BuildArgs | map[string]string | `buildArgs` | nil | Docker build arguments (`--build-arg K=V`) |
| Workdir | string | `workdir` | empty | Working directory inside the container (`-w` flag) |
| InheritEnv | []string | `inheritEnv` | nil | Host environment variable names to forward to the container |
| Mounts | []Mount | `mounts` | nil | Bind mounts passed to the container (`-v` flag) |

All fields are optional. If `pod.json` is absent, all fields use their zero values.

`InheritEnv` names are resolved by the Dispatcher via `os.Getenv` at dispatch time. If a name has no value on the host, it is silently skipped. Resolved values are merged into the `Env` map before being passed to the Runner.

## Mount

A bind mount to pass to the container.

```go
type Mount struct {
    Source   string // host path
    Target   string // container path
    ReadOnly bool
}
```

| Field | Type | JSON Key | Description |
|-------|------|----------|-------------|
| Source | string | `source` | Absolute path on the host |
| Target | string | `target` | Absolute path inside the container |
| ReadOnly | bool | `readOnly` | Mount as read-only (`-v source:target:ro`) |

## EventType

Identifies the kind of event emitted by a Session.

```go
type EventType int

const (
    EventBuildStarted    EventType = iota // Image build begins
    EventBuildComplete                     // Image build succeeds
    EventContainerStarted                  // Container begins running
    EventOutput                            // Line of container stdout
    EventContainerExited                   // Container exits normally
    EventError                             // Fatal error terminates session
)
```

## Event

A lifecycle or output event emitted by a Session.

```go
type Event struct {
    Type EventType
    Data string
    Code int
    Time time.Time
}
```

| Field | Type | Description |
|-------|------|-------------|
| Type | EventType | The kind of event |
| Data | string | Payload: image tag, container name, line content, or error message depending on Type |
| Code | int | Exit code (only meaningful for `EventContainerExited`) |
| Time | time.Time | Timestamp of the event |

Temporal ordering guarantees:

- Successful start: `BuildStarted` -> `BuildComplete` -> `ContainerStarted` -> `Output*` -> `ContainerExited`
- Build failure: `BuildStarted` -> `Error` (no Session returned)
- Runtime failure: `BuildStarted` -> `BuildComplete` -> `ContainerStarted` -> `Output*` -> `Error`

After the terminal event (`ContainerExited` or `Error`), the channel is closed.

## Session

Represents an active pod lifecycle.

```go
type Session struct {
    // unexported fields
}
```

Created by `Dispatcher.Start` or `Dispatcher.Resume`. The caller owns the Session and interacts with it through four methods:

| Method | Signature | Description |
|--------|-----------|-------------|
| `ID` | `() string` | Returns the unique session identifier (`<podName>-<hex8>`) |
| `Events` | `() <-chan Event` | Returns a receive-only channel of typed events |
| `Stop` | `(ctx context.Context) error` | Graceful shutdown: SIGTERM with 10-second timeout |
| `Wait` | `() (int, error)` | Blocks until the container exits, returns exit code |

`Stop` is idempotent. `Events` and `Wait` are independent consumption paths.

## Runner

Interface over Docker CLI operations.

```go
type Runner interface {
    Build(ctx context.Context, tag string, dir string, buildArgs map[string]string) error
    Run(ctx context.Context, opts RunOptions, stdout io.Writer) (int, error)
    Exec(ctx context.Context, container string, cmd []string, stdout io.Writer) (int, error)
    Stop(ctx context.Context, container string, timeout time.Duration) error
}
```

All methods are synchronous and blocking. `DockerRunner` is the standard implementation using `os/exec`. Custom implementations can be provided for testing or alternative container runtimes.

## RunOptions

Configuration for a `docker run` invocation.

```go
type RunOptions struct {
    Image      string
    Name       string
    Cmd        []string
    Env        map[string]string
    Workdir    string
    Remove     bool
    InheritEnv []string
    Mounts     []Mount
}
```

| Field | Type | Description |
|-------|------|-------------|
| Image | string | Docker image to run |
| Name | string | Container name (session ID for Start, `cldpd-<podname>` for Resume) |
| Cmd | []string | Command and arguments (`["claude", "-p", "..."]`) |
| Env | map[string]string | Environment variables (`-e K=V`) |
| Workdir | string | Working directory inside container (`-w`) |
| Remove | bool | Remove container on exit (`--rm`) |
| InheritEnv | []string | Host env var names passed as bare `-e NAME` for Docker host inheritance |
| Mounts | []Mount | Bind mounts (`-v source:target[:ro]`) |

## Dispatcher

Coordinates pod discovery, image building, and container lifecycle.

```go
type Dispatcher struct {
    // unexported fields
}
```

Created via `NewDispatcher(podsDir, runner)`. The Dispatcher is stateless -- it does not track running sessions. Each returned `*Session` is self-contained. Interact with it through `Start` and `Resume`.

## DockerRunner

Implements `Runner` using the Docker CLI via `os/exec`.

```go
type DockerRunner struct{}
```

Zero-value is ready to use. Also provides `Preflight(ctx)` for Docker availability checks.

## Errors

Semantic sentinel errors checked with `errors.Is`:

```go
var (
    ErrPodNotFound       = errors.New("pod not found")
    ErrInvalidPod        = errors.New("invalid pod: Dockerfile not found")
    ErrBuildFailed       = errors.New("image build failed")
    ErrContainerFailed   = errors.New("container exited with error")
    ErrSessionNotFound   = errors.New("no running session for pod")
    ErrDockerUnavailable = errors.New("docker is not available")
    ErrStopFailed        = errors.New("container stop failed")
)
```

| Error | Returned By | Meaning |
|-------|-------------|---------|
| `ErrPodNotFound` | DiscoverPod, Start | Pod directory does not exist |
| `ErrInvalidPod` | DiscoverPod, Start | Pod directory has no Dockerfile |
| `ErrBuildFailed` | Build, Start | Docker image build failed |
| `ErrContainerFailed` | (reserved) | Container exited with non-zero code |
| `ErrSessionNotFound` | Exec, Resume | No running container for the pod |
| `ErrDockerUnavailable` | Preflight | Docker daemon unreachable |
| `ErrStopFailed` | Stop, Session.Stop | Docker stop failed |

Errors are wrapped with context at call sites using `fmt.Errorf("...: %w", err)`. Use `errors.Is` to check for specific conditions:

```go
session, err := d.Start(ctx, "myrepo", issueURL)
if errors.Is(err, cldpd.ErrPodNotFound) {
    // pod directory does not exist
}
if errors.Is(err, cldpd.ErrBuildFailed) {
    // image build failed, no session created
}
```
