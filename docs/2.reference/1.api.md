---
title: API Reference
description: Complete function documentation for cldpd
author: zoobzio
published: 2026-02-21
updated: 2026-02-21
tags:
  - Reference
  - API
---

# API Reference

## Dispatcher

### NewDispatcher

```go
func NewDispatcher(podsDir string, runner Runner) *Dispatcher
```

Creates a Dispatcher that discovers pods from `podsDir` and executes Docker operations via `runner`.

```go
d := cldpd.NewDispatcher("/home/user/.cldpd/pods", &cldpd.DockerRunner{})
```

### DefaultPodsDir

```go
func DefaultPodsDir() (string, error)
```

Returns the conventional pods directory: `~/.cldpd/pods/`.

Returns an error if the user's home directory cannot be determined.

```go
dir, err := cldpd.DefaultPodsDir()
// dir == "/home/user/.cldpd/pods"
```

### Dispatcher.Start

```go
func (d *Dispatcher) Start(ctx context.Context, podName string, issueURL string, stdout io.Writer) (int, error)
```

Discovers the named pod, builds its Docker image, runs a container with a Claude Code prompt pointing at the issue URL, and streams container stdout to the provided writer. Blocks until the container exits.

Returns the container's exit code. A non-zero exit code also returns `ErrContainerFailed`.

**Errors:**
- `ErrPodNotFound` -- pod directory does not exist
- `ErrInvalidPod` -- pod directory exists but has no Dockerfile
- `ErrBuildFailed` -- Docker image build failed
- `ErrContainerFailed` -- container exited with non-zero status

```go
code, err := d.Start(ctx, "myrepo", "https://github.com/org/repo/issues/42", os.Stdout)
```

### Dispatcher.Resume

```go
func (d *Dispatcher) Resume(ctx context.Context, podName string, prompt string, stdout io.Writer) (int, error)
```

Sends a follow-up prompt to a running pod's container via `docker exec`. The container name is derived deterministically from the pod name (`cldpd-<podName>`).

Returns the command's exit code.

**Errors:**
- `ErrSessionNotFound` -- no running container named `cldpd-<podName>`

```go
code, err := d.Resume(ctx, "myrepo", "Focus on error handling", os.Stdout)
```

## Pod Discovery

### DiscoverPod

```go
func DiscoverPod(podsDir, name string) (Pod, error)
```

Loads a single pod definition by name from the given pods directory. Validates that the Dockerfile exists and parses `pod.json` if present.

**Errors:**
- `ErrPodNotFound` -- directory `<podsDir>/<name>/` does not exist
- `ErrInvalidPod` -- directory exists but contains no Dockerfile
- Parse error -- `pod.json` exists but is malformed JSON

```go
pod, err := cldpd.DiscoverPod("/home/user/.cldpd/pods", "myrepo")
```

### DiscoverAll

```go
func DiscoverAll(podsDir string) ([]Pod, error)
```

Loads all valid pods from the given directory. Skips entries that are not directories or lack a Dockerfile. Returns a slice sorted by pod name.

```go
pods, err := cldpd.DiscoverAll("/home/user/.cldpd/pods")
```

## Docker Operations

### DockerRunner.Preflight

```go
func (d *DockerRunner) Preflight(ctx context.Context) error
```

Checks that the Docker daemon is reachable by running `docker info`.

**Errors:**
- `ErrDockerUnavailable` -- Docker daemon cannot be contacted

```go
runner := &cldpd.DockerRunner{}
if err := runner.Preflight(ctx); err != nil {
    // Docker is not available
}
```

### DockerRunner.Build

```go
func (d *DockerRunner) Build(ctx context.Context, tag string, dir string, buildArgs map[string]string) error
```

Builds a Docker image from the Dockerfile in `dir`, tagged with `tag`. Build arguments are passed as `--build-arg` flags.

**Errors:**
- `ErrBuildFailed` -- build exited with non-zero status

### DockerRunner.Run

```go
func (d *DockerRunner) Run(ctx context.Context, opts RunOptions, stdout io.Writer) (int, error)
```

Starts a container with the given options, streams stdout to the provided writer, and blocks until the container exits. Returns the exit code.

A non-zero exit code is returned as `(code, nil)` -- it is not itself an error. Process-level failures (context cancellation, exec errors) return `(-1, err)`.

### DockerRunner.Exec

```go
func (d *DockerRunner) Exec(ctx context.Context, container string, cmd []string, stdout io.Writer) (int, error)
```

Runs a command in an already-running container. Preflights with `docker inspect` to verify the container exists and is running before attempting the exec.

**Errors:**
- `ErrSessionNotFound` -- container does not exist or is not running
